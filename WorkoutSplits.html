<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Workout Split Plans</title>
  <style>
    :root {
      --primary: #e11d2e; /* modern red */
      --ink: #0f1115;
      --bg: #171819;
      --card: #ffffff;
      --muted: #687387;
      --radius: 12px;
    }

    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: #fff;
      margin: 0;
      padding: 24px;
    }

    .container {
      max-width: 980px;
      margin: auto;
      background: var(--card);
      color: var(--ink);
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }

    header h1 {
      margin: 0 0 8px;
      font-size: clamp(24px, 3vw, 34px);
      letter-spacing: .3px;
      color: var(--primary);
      text-align: center;
    }
    header p { margin: 0; text-align: center; color: var(--muted); }

    /* Toolbar */
    .toolbar {
      display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: center;
      margin: 18px 0 8px;
    }
    .btn {
      appearance: none; border: 1px solid var(--primary); background: #fff; color: var(--primary);
      padding: 10px 14px; border-radius: 999px; cursor: pointer; font-weight: 600; font-size: 14px;
      transition: transform .1s ease, background .2s ease, color .2s ease, box-shadow .2s ease;
    }
    .btn:hover, .btn:focus-visible { background: var(--primary); color: #fff; box-shadow: 0 8px 20px rgba(225,29,46,.25); outline: none; transform: translateY(-1px); }
    .btn.secondary { border-color: #E5E7EB; color: #111827; }

    .search {
      flex: 1 1 260px; max-width: 460px; display: flex; align-items: center; gap: 8px; background: #f5f7fb; border-radius: 999px; padding: 8px 12px; border: 1px solid #e6e9f0;
    }
    .search input { flex: 1; border: 0; background: transparent; outline: none; font-size: 14px; color: #111; }

    /* Tabs */
    .tabs { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; margin: 16px 0 8px; }
    .tab { border: 1px solid var(--primary); background: #fff; color: var(--primary); border-radius: 10px; padding: 12px 16px; cursor: pointer; font-weight: 600; text-align: center; }
    .tab[aria-selected="true"], .tab:hover, .tab:focus-visible { background: var(--primary); color: #fff; outline: none; }

    .panel { display: none; animation: fadeIn .35s ease both; }
    .panel.active { display: block; }

    .day { border: 1px solid #f0b6bc; border-radius: 12px; margin: 12px 0; background: #fff7f8; overflow: hidden; }
    .day-header { width: 100%; display: flex; justify-content: space-between; align-items: center; gap: 8px; background: #ffe8ea; border: 0; padding: 14px 16px; font-weight: 700; color: var(--primary); cursor: pointer; }
    .chev { transition: transform .2s ease; }
    .day-header[aria-expanded="true"] .chev { transform: rotate(90deg); }

    .day-details { padding: 8px 16px 16px; }
    .muted { color: var(--muted); }

    ul { margin: 6px 0 0 18px; }

    /* Exercise hover/tooltip */
    .exercise-link { position: relative; display: inline-block; padding: 1px 6px; border-radius: 8px; cursor: pointer; text-decoration: none; color: inherit; border-bottom: 1px dashed var(--primary); transition: background .18s ease, box-shadow .18s ease, transform .12s ease, color .18s ease; }
    .exercise-link:hover, .exercise-link:focus-visible { background: rgba(225,29,46,.10); color: var(--primary); transform: translateY(-1px); box-shadow: 0 0 0 2px rgba(225,29,46,.12); outline: none; }
    .exercise-link::after { content: "►"; font-size: .9em; margin-left: 6px; opacity: 0; transform: translateX(-4px); transition: transform .18s ease, opacity .18s ease; vertical-align: baseline; }
    .exercise-link:hover::after, .exercise-link:focus-visible::after { opacity: 1; transform: translateX(0); }
    .exercise-link::before { content: attr(data-tip); position: absolute; left: 50%; bottom: 120%; transform: translateX(-50%) translateY(6px); background: #111; color: #fff; padding: 6px 8px; border-radius: 6px; font-size: 12px; line-height: 1; white-space: nowrap; opacity: 0; pointer-events: none; box-shadow: 0 6px 18px rgba(0,0,0,.35); transition: opacity .12s ease, transform .12s ease; }
    .exercise-link:hover::before, .exercise-link:focus-visible::before { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Dialog */
    dialog#videoModal { width: min(900px, 96vw); border: 0; border-radius: 16px; padding: 0; overflow: hidden; box-shadow: 0 30px 80px rgba(0,0,0,.5); }
    dialog::backdrop { background: rgba(0,0,0,.5); }
    .modal-head { display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 14px 16px; border-bottom: 1px solid #eef0f4; background: #fff; }
    .modal-title { margin: 0; font-size: 18px; }
    .modal-close { appearance: none; border: 0; background: #f4f6f8; border-radius: 8px; width: 36px; height: 36px; cursor: pointer; font-size: 20px; }
    .modal-body { background: #0b0b0b; color: #fff; padding: 14px; }
    .modal-note { font-size: 13px; color: #b9c0ce; margin-top: 8px; }

    /* Utilities */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(2px);} to { opacity: 1; transform: translateY(0);} }
    @media (max-width: 640px){ .tabs { grid-template-columns: 1fr; } }
    @media (prefers-reduced-motion: reduce){ * { animation: none !important; transition: none !important; } }
    mark { background: #fff0a8; padding: 0 2px; border-radius: 4px; }
    .hidden { display: none !important; }
    .result-focus { outline: 3px solid var(--primary); outline-offset: 2px; border-radius: 8px; background: #fff3f3; }
    .toolbar .count { min-width: 110px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Workout Split Plans</h1>
      <p class="muted">Click any exercise name to preview a local video in-page.</p>
    </header>

    <div class="toolbar" role="toolbar" aria-label="Page tools">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-3.8-3.8M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4Z" stroke="#7a8599" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Quick find an exercise… (e.g., lat pull down)" autocomplete="off" />
      </div>
      <button class="btn" id="expandAll" type="button">Expand all</button>
      <button class="btn secondary" id="collapseAll" type="button">Collapse all</button>
      <button class="btn secondary" id="printBtn" type="button">Print</button>
      <button class="btn secondary" id="clearSearch" type="button">Clear</button>
      <button class="btn" id="prevHit" type="button" disabled>Prev</button>
      <button class="btn" id="nextHit" type="button" disabled>Next</button>
      <span id="hitCount" class="count muted" aria-live="polite"></span>
      <button class="btn secondary" id="filterBtn" type="button" aria-pressed="false" title="Hide non-matching items">Filter mode</button>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="Split types">
      <button class="tab" role="tab" id="tab-total" aria-selected="true" aria-controls="panel-total" data-panel="#panel-total">Total Body Splits</button>
      <button class="tab" role="tab" id="tab-upperlower" aria-selected="false" aria-controls="panel-upperlower" data-panel="#panel-upperlower">Upper/Lower Splits</button>
      <button class="tab" role="tab" id="tab-ppl" aria-selected="false" aria-controls="panel-ppl" data-panel="#panel-ppl">Push–Pull–Legs Splits</button>
    </div>

    <!-- Panels -->
    <section id="panel-total" class="panel active" role="tabpanel" aria-labelledby="tab-total">
      <h2>Total Body Splits</h2>
      <p class="muted">Full-body routines 3×/week. Ideal for beginners or busy schedules.</p>

      <div class="day" data-id="t1">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t1-c">
          <span>Day 1: Full Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t1-c" hidden>
          <ul>
            <li>Legs – Leg Press, Calf Raises</li>
            <li>Chest – Incline Bench Press, Pec Deck Fly</li>
            <li>Back – Lat Pull Down, T‑Bar Rows</li>
            <li>Shoulders – Shoulder Press, Lateral Raises</li>
            <li>Arms – Dumbbell Curl, Triceps Pushdown</li>
            <li>Abs – Crunches, Leg Raises</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="t2">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t2-c">
          <span>Day 2: Rest</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t2-c" hidden>
          <p class="muted">Take a break and let your muscles recover.</p>
        </div>
      </div>

      <div class="day" data-id="t3">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t3-c">
          <span>Day 3: Full Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t3-c" hidden>
          <ul>
            <li>Legs – Leg Press, Calf Raises</li>
            <li>Chest – Incline Bench Press, Pec Deck Fly</li>
            <li>Back – Lat Pull Down, T‑Bar Rows</li>
            <li>Shoulders – Shoulder Press, Lateral Raises</li>
            <li>Arms – Dumbbell Curl, Triceps Pushdown</li>
            <li>Abs – Crunches, Leg Raises</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="t4">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t4-c">
          <span>Day 4: Rest</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t4-c" hidden>
          <p class="muted">Stretch, hydrate, or go for a light walk.</p>
        </div>
      </div>

      <div class="day" data-id="t5">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t5-c">
          <span>Day 5: Full Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t5-c" hidden>
          <ul>
            <li>Legs – Leg Press, Calf Raises</li>
            <li>Chest – Incline Bench Press, Pec Deck Fly</li>
            <li>Back – Lat Pull Down, T‑Bar Rows</li>
            <li>Shoulders – Shoulder Press, Lateral Raises</li>
            <li>Arms – Dumbbell Curl, Triceps Pushdown</li>
            <li>Abs – Crunches, Leg Raises</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="t6">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t6-c">
          <span>Day 6: Rest</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t6-c" hidden>
          <p class="muted">Recovery day. Consider foam rolling or yoga.</p>
        </div>
      </div>

      <div class="day" data-id="t7">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="t7-c">
          <span>Day 7: Rest</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="t7-c" hidden>
          <p class="muted">Enjoy your rest day. Prepare for the week ahead.</p>
        </div>
      </div>
    </section>

    <section id="panel-upperlower" class="panel" role="tabpanel" aria-labelledby="tab-upperlower">
      <h2>Upper Body / Lower Body Splits</h2>
      <p class="muted">4×/week split ideal for intermediate progression.</p>

      <div class="day" data-id="u1">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u1-c">
          <span>Day 1: Upper Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="u1-c" hidden>
          <ul>
            <li>Chest – Flat Bench Press, Chest Press</li>
            <li>Back – Seated Cable Row, Reverse Pec Deck Fly</li>
            <li>Shoulders – Front Raises, Face Pulls</li>
            <li>Biceps – Hammer Curls, Concentration Curls</li>
            <li>Triceps – Skull Crushers, Overhead Extension</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="u2">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u2-c">
          <span>Day 2: Lower Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="u2-c" hidden>
          <ul>
            <li>Quads/Glutes – Hack Squats, Leg Extension</li>
            <li>Calves – Calf Raises</li>
            <li>Hamstrings – Optional (add Romanian Deadlift if available)</li>
            <li>Abs – Russian Twists, V‑Sits</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="u3">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u3-c"><span>Day 3: Rest</span><span class="chev">▶</span></button>
        <div class="day-details" id="u3-c" hidden>
          <p class="muted">Focus on recovery. Light stretching is encouraged.</p>
        </div>
      </div>

      <div class="day" data-id="u4">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u4-c">
          <span>Day 4: Upper Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="u4-c" hidden>
          <ul>
            <li>Chest – Flat Bench Press, Chest Press</li>
            <li>Back – Seated Cable Row, Reverse Pec Deck Fly</li>
            <li>Shoulders – Front Raises, Face Pulls</li>
            <li>Biceps – Hammer Curls, Concentration Curls</li>
            <li>Triceps – Skull Crushers, Overhead Extension</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="u5">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u5-c">
          <span>Day 5: Lower Body</span><span class="chev">▶</span>
        </button>
        <div class="day-details" id="u5-c" hidden>
          <ul>
            <li>Quads/Glutes – Hack Squats, Leg Extension</li>
            <li>Calves – Calf Raises</li>
            <li>Hamstrings – Optional (add Romanian Deadlift if available)</li>
            <li>Abs – Russian Twists, V‑Sits</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="u6">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u6-c"><span>Day 6: Rest</span><span class="chev">▶</span></button>
        <div class="day-details" id="u6-c" hidden>
          <p class="muted">Recovery day. Rest or do light cardio.</p>
        </div>
      </div>

      <div class="day" data-id="u7">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="u7-c"><span>Day 7: Rest</span><span class="chev">▶</span></button>
        <div class="day-details" id="u7-c" hidden>
          <p class="muted">Rest and plan your upcoming training cycle.</p>
        </div>
      </div>
    </section>

    <section id="panel-ppl" class="panel" role="tabpanel" aria-labelledby="tab-ppl">
      <h2>Push–Pull–Legs Splits</h2>
      <p class="muted">Advanced 6×/week plan. Hit each muscle group twice weekly.</p>

      <div class="day" data-id="p1">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p1-c"><span>Day 1: Push (Chest, Shoulders, Triceps)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p1-c" hidden>
          <ul>
            <li>Incline Bench Press</li>
            <li>Flat Bench Press</li>
            <li>Shoulder Press</li>
            <li>Lateral Raises</li>
            <li>Triceps Pushdown</li>
            <li>Overhead Extension</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="p2">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p2-c"><span>Day 2: Pull (Back, Biceps, Rear Delts)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p2-c" hidden>
          <ul>
            <li>Lat Pull Down</li>
            <li>T‑Bar Rows</li>
            <li>Seated Cable Row</li>
            <li>Reverse Pec Deck Fly</li>
            <li>Dumbbell Curls</li>
            <li>Hammer Curls</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="p3">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p3-c"><span>Day 3: Legs (Quads, Glutes, Calves & Abs)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p3-c" hidden>
          <ul>
            <li>Hack Squats</li>
            <li>Leg Press</li>
            <li>Leg Extension</li>
            <li>Calf Raises</li>
            <li>Leg Raises</li>
            <li>Russian Twists</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="p4">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p4-c"><span>Day 4: Rest</span><span class="chev">▶</span></button>
        <div class="day-details" id="p4-c" hidden>
          <p class="muted">Rest and plan your upcoming training cycle.</p>
        </div>
      </div>

      <div class="day" data-id="p5">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p5-c"><span>Day 5: Push (Chest, Shoulders, Triceps)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p5-c" hidden>
          <ul>
            <li>Incline Bench Press</li>
            <li>Flat Bench Press</li>
            <li>Shoulder Press</li>
            <li>Lateral Raises</li>
            <li>Triceps Pushdown</li>
            <li>Overhead Extension</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="p6">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p6-c"><span>Day 6: Pull (Back, Biceps, Rear Delts)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p6-c" hidden>
          <ul>
            <li>Lat Pull Down</li>
            <li>T‑Bar Rows</li>
            <li>Seated Cable Row</li>
            <li>Reverse Pec Deck Fly</li>
            <li>Dumbbell Curls</li>
            <li>Hammer Curls</li>
          </ul>
        </div>
      </div>

      <div class="day" data-id="p7">
        <button class="day-header" type="button" aria-expanded="false" aria-controls="p7-c"><span>Day 7: Legs (Quads, Glutes, Calves & Abs)</span><span class="chev">▶</span></button>
        <div class="day-details" id="p7-c" hidden>
          <ul>
            <li>Hack Squats</li>
            <li>Leg Press</li>
            <li>Leg Extension</li>
            <li>Calf Raises</li>
            <li>Leg Raises</li>
            <li>Russian Twists</li>
          </ul>
        </div>
      </div>
    </section>
  </div>

  <!-- In-page video dialog -->
  <dialog id="videoModal" aria-label="Exercise video">
    <div class="modal-head">
      <h3 id="videoTitle" class="modal-title">Exercise Video</h3>
      <button class="modal-close" aria-label="Close" id="closeBtn">×</button>
    </div>
    <div class="modal-body">
      <video id="videoPlayer" controls playsinline style="width:100%;height:auto;border-radius:10px;background:#000"></video>
      <div id="videoNote" class="modal-note"></div>
    </div>
  </dialog>

  <script>
  (function(){
    const ls = window.localStorage;

    // ===== Tabs (accessible, stateful) =====
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const panels = Array.from(document.querySelectorAll('.panel'));
    const TAB_KEY = 'ws-active-tab';

    function setActiveTab(targetId){
      tabs.forEach(t => t.setAttribute('aria-selected', String(t.dataset.panel === ('#'+targetId))));
      panels.forEach(p => p.classList.toggle('active', p.id === targetId));
      ls.setItem(TAB_KEY, targetId);
      history.replaceState(null, '', '#' + targetId);
      const qEl = document.getElementById('q');
      if (typeof window.__wsPerformSearch === 'function' && qEl) window.__wsPerformSearch(qEl.value);
    }

    // Click / keyboard activation
    tabs.forEach(tab => {
      tab.addEventListener('click', () => setActiveTab(tab.getAttribute('aria-controls')));
      tab.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowRight' || e.key === 'ArrowLeft'){
          e.preventDefault();
          const i = tabs.indexOf(tab);
          const dir = e.key === 'ArrowRight' ? 1 : -1;
          const next = tabs[(i + dir + tabs.length) % tabs.length];
          next.focus();
        }
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab(tab.getAttribute('aria-controls')); }
      });
    });

    // Restore from hash or localStorage
    const initial = location.hash?.slice(1) || ls.getItem(TAB_KEY) || 'panel-total';
    if (initial && document.getElementById(initial)) setActiveTab(initial);

    // ===== Collapsibles =====
    const days = Array.from(document.querySelectorAll('.day'));

    function toggleDay(day, force){
      const btn = day.querySelector('.day-header');
      const panel = day.querySelector('.day-details');
      const open = force !== undefined ? !!force : panel.hasAttribute('hidden');
      btn.setAttribute('aria-expanded', String(open));
      panel.toggleAttribute('hidden', !open);
    }

    // click handlers on headers only (avoids accidental toggles)
    days.forEach(day => {
      const btn = day.querySelector('.day-header');
      btn.addEventListener('click', ()=> toggleDay(day));
      btn.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleDay(day); } });
    });

    document.getElementById('expandAll').addEventListener('click', ()=> days.forEach(d => toggleDay(d, true)) );
    document.getElementById('collapseAll').addEventListener('click', ()=> days.forEach(d => toggleDay(d, false)) );
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());

    // ===== Exercise linkify (canonicalize names -> local video path) =====
    const canonical = {
      "incline bench press": "incline bench press",
      "flat bench press": "flat bench press",
      "shoulder press": "shoulder press",
      "lateral raises": "lateral raises",
      "triceps pushdown": "tricep pushdown",
      "overhead extension": "overhead extension",
      "lat pull down": "lat pull down",
      "t-bar rows": "t-bar rows",
      "seated cable row": "seated cable row",
      "reverse pec deck fly": "reverse pec deck fly",
      "dumbbell curls": "dumbbell bicep curl",
      "dumbbell curl": "dumbbell bicep curl",
      "hammer curls": "hammer curl",
      "concentration curls": "concentration curl",
      "front raises": "front raise",
      "face pulls": "face pull",
      "skull crushers": "skull crusher",
      "leg press": "leg press",
      "calf raises": "calf raises",
      "hack squats": "hack squat",
      "leg extension": "leg extension",
      "romanian deadlift": "romanian deadlift",
      "crunches": "crunch",
      "leg raises": "leg raise",
      "russian twists": "russian twist",
      "v-sits": "v sit",
      "pec-deck fly": "pec deck fly",
      "chest press": "chest press"
    };

    const keys = Object.keys(canonical).sort((a,b)=> b.length - a.length);
    const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const slugify = s => s.toLowerCase().replace(/&/g, ' and ').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').replace(/--+/g,'-');

    function linkify(text){
      let out = text;
      keys.forEach(k => {
        const re = new RegExp("\\b" + esc(k) + "\\b", 'gi');
        out = out.replace(re, (m)=>{
          const canon = canonical[k.toLowerCase()] || m;
          const slug = slugify(canon);
          const path = `videos/${slug}.mp4`;
          const tip = `Play: ${canon}`;
          return `<span class="exercise-link" data-exercise="${canon}" data-src="${path}" data-tip="${tip}" title="${tip}" tabindex="0">${m}</span>`;
        });
      });
      return out;
    }

    document.querySelectorAll('.day-details li').forEach(li => { li.innerHTML = linkify(li.innerHTML); });

    // ===== Search (robust, cross-tab with nav & filter) =====
    const state = { results: [], idx: -1, filter: false };
    const q = document.getElementById('q');
    const prevBtn = document.getElementById('prevHit');
    const nextBtn = document.getElementById('nextHit');
    const clearBtn = document.getElementById('clearSearch');
    const filterBtn = document.getElementById('filterBtn');
    const countEl = document.getElementById('hitCount');

    function clearMarks(root){
      root.querySelectorAll('mark').forEach(m => { const p = m.parentNode; while(m.firstChild) p.insertBefore(m.firstChild, m); p.removeChild(m); });
      root.querySelectorAll('.result-focus').forEach(el => el.classList.remove('result-focus'));
      root.querySelectorAll('.hidden').forEach(el => el.classList.remove('hidden'));
    }

    function highlightTerm(el, term){
      if(!term) return;
      const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, null);
      const nodes = [];
      while(walker.nextNode()) nodes.push(walker.currentNode);
      nodes.forEach(node => {
        const text = node.nodeValue;
        const lower = text.toLowerCase();
        let start = 0;
        if(lower.indexOf(term) === -1) return;
        const frag = document.createDocumentFragment();
        while(true){
          const idx = lower.indexOf(term, start);
          if(idx === -1) break;
          if(idx > start) frag.append(document.createTextNode(text.slice(start, idx)));
          const mark = document.createElement('mark');
          mark.textContent = text.slice(idx, idx + term.length);
          frag.append(mark);
          start = idx + term.length;
        }
        if(start < text.length) frag.append(document.createTextNode(text.slice(start)));
        node.parentNode.replaceChild(frag, node);
      });
    }

    function highlightTerms(el, terms){ terms.forEach(t => highlightTerm(el, t.toLowerCase())); }

    function updateCount(){
      if(!state.results.length){ countEl.textContent = 'No matches'; prevBtn.disabled = true; nextBtn.disabled = true; return; }
      countEl.textContent = (state.idx+1) + '/' + state.results.length + ' matches';
      prevBtn.disabled = state.results.length < 2;
      nextBtn.disabled = state.results.length < 2;
    }

    function focusResult(i){
      state.results.forEach(li => li.classList.remove('result-focus'));
      const li = state.results[i];
      if(!li) return;
      li.classList.add('result-focus');
      li.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function performSearch(term){
      window.__wsPerformSearch = performSearch;

      const panelsAll = Array.from(document.querySelectorAll('.panel'));
      panelsAll.forEach(p => clearMarks(p));
      state.results = []; state.idx = -1;
      const clean = term.trim();
      if(!clean){ updateCount(); return; }
      const terms = clean.split(' ').filter(Boolean);

      let activePanel = document.querySelector('.panel.active');
      const ordered = [activePanel, ...panelsAll.filter(p => p !== activePanel)];
      let firstPanelWithHit = null;

      ordered.forEach(panel => {
        const items = Array.from(panel.querySelectorAll('.day-details li'));
        let panelHit = false;
        items.forEach(li => {
          const text = li.textContent.toLowerCase();
          const isMatch = terms.every(t => text.includes(t.toLowerCase()));
          if(isMatch){
            const day = li.closest('.day');
            if(day) toggleDay(day, true);
            highlightTerms(li, terms);
            state.results.push(li);
            panelHit = true;
          } else if(state.filter){
            li.classList.add('hidden');
          }
        });
        if(state.filter){
          panel.querySelectorAll('.day').forEach(day => {
            if(!day.querySelector('li:not(.hidden)')) day.classList.add('hidden');
          });
        }
        if(panelHit && !firstPanelWithHit) firstPanelWithHit = panel.id;
      });

      if(firstPanelWithHit && document.querySelector('.panel.active') && document.querySelector('.panel.active').id !== firstPanelWithHit){
        setActiveTab(firstPanelWithHit);
      }

      if(state.results.length){ state.idx = 0; focusResult(0); }
      updateCount();
    }

    let tId;
    q.addEventListener('input', () => { clearTimeout(tId); tId = setTimeout(() => performSearch(q.value), 120); });
    q.addEventListener('keydown', (e) => { if(e.key === 'Enter'){ if(state.results.length){ state.idx = (state.idx + 1) % state.results.length; focusResult(state.idx); updateCount(); } } });

    nextBtn.addEventListener('click', ()=> { if(!state.results.length) return; state.idx = (state.idx + 1) % state.results.length; focusResult(state.idx); updateCount(); });
    prevBtn.addEventListener('click', ()=> { if(!state.results.length) return; state.idx = (state.idx - 1 + state.results.length) % state.results.length; focusResult(state.idx); updateCount(); });

    clearBtn.addEventListener('click', ()=> { q.value = ''; state.filter = false; filterBtn.setAttribute('aria-pressed','false'); document.querySelectorAll('.panel').forEach(p => clearMarks(p)); state.results = []; state.idx = -1; updateCount(); });
    filterBtn.addEventListener('click', ()=> { state.filter = !state.filter; filterBtn.setAttribute('aria-pressed', String(state.filter)); performSearch(q.value); });

    performSearch('');

    // ===== Modal video player (with friendly error text) ===== (with friendly error text) =====
    const dlg = document.getElementById('videoModal');
    const v = document.getElementById('videoPlayer');
    const titleEl = document.getElementById('videoTitle');
    const note = document.getElementById('videoNote');
    const closeBtn = document.getElementById('closeBtn');

    function openVideo(title, src){
      titleEl.textContent = title || 'Exercise Video';
      note.textContent = src ? `Expected local file: ./${src}` : '';
      v.src = src || '';
      v.currentTime = 0;
      v.onerror = () => {
        note.innerHTML = `Could not load <code>${src}</code>. Place a local file at that path (relative to this HTML), or update the mapping.`;
      };
      if(typeof dlg.showModal === 'function') dlg.showModal(); else dlg.setAttribute('open','');
      v.play().catch(()=>{});
    }

    function closeVideo(){ try { v.pause(); } catch(e){} v.removeAttribute('src'); v.load(); if(typeof dlg.close === 'function') dlg.close(); else dlg.removeAttribute('open'); }
    closeBtn.addEventListener('click', closeVideo);
    dlg.addEventListener('cancel', closeVideo);
    dlg.addEventListener('click', (e)=>{ const r = dlg.getBoundingClientRect(); if(e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom){ closeVideo(); }});

    // Delegate clicks+keyboard from any exercise-link
    document.body.addEventListener('click', (e)=>{
      const el = e.target.closest('.exercise-link');
      if(!el) return;
      e.preventDefault();
      openVideo(el.dataset.exercise, el.dataset.src);
    });
    document.body.addEventListener('keydown', (e)=>{
      if((e.key === 'Enter' || e.key === ' ') && e.target.classList?.contains('exercise-link')){
        e.preventDefault();
        const el = e.target; openVideo(el.dataset.exercise, el.dataset.src);
      }
    });
  })();
  </script>
</body>
</html>
